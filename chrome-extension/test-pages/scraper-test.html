<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Field Scraper Test Page</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
    .section { margin-bottom: 2rem; padding: 1rem; border: 1px solid #eee; border-radius: 8px; }
    label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
    input, select, textarea { width: 100%; max-width: 400px; padding: 8px; margin-bottom: 1rem; }
    .required::after { content: " *"; color: red; }
    #test-result { margin-top: 2rem; padding: 1rem; background: #f5f5f5; border-radius: 8px; white-space: pre-wrap; }
    .hidden-section { display: none; }
  </style>
</head>
<body>
  <h1>Field Scraper Test Page</h1>
  <p>This page contains various form field types to test the Chrome extension field scraper.</p>

  <form id="job-application" data-testid="scraper-test-page">
    <!-- Standard ATS fields -->
    <section class="section" aria-label="Personal Information">
      <h2>Personal Information</h2>
      <div class="form-group">
        <label for="first_name">First Name</label>
        <input type="text" id="first_name" name="job_application[first_name]" required placeholder="Enter first name">
      </div>
      <div class="form-group">
        <label for="last_name">Last Name</label>
        <input type="text" id="last_name" name="job_application[last_name]" required>
      </div>
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" name="job_application[email]" required>
      </div>
      <div class="form-group">
        <label for="phone">Phone</label>
        <input type="tel" id="phone" name="job_application[phone]" placeholder="+1 234 567 8900">
      </div>
    </section>

    <section class="section">
      <h2>Resume & Cover Letter</h2>
      <div class="form-group application-question">
        <label for="resume_upload" class="question-text">Resume / CV</label>
        <input type="file" id="resume_upload" name="resume" accept=".pdf,.doc,.docx" required>
      </div>
      <div class="form-group">
        <label for="cover_letter">Cover Letter</label>
        <textarea id="cover_letter" name="cover_letter" rows="4" placeholder="Paste your cover letter here"></textarea>
      </div>
    </section>

    <section class="section">
      <h2>Additional Fields</h2>
      <div class="form-group">
        <label for="linkedin">LinkedIn URL</label>
        <input type="url" id="linkedin" name="linkedin_url" placeholder="https://linkedin.com/in/...">
      </div>
      <div class="form-group">
        <label for="portfolio">Portfolio / Website</label>
        <input type="url" id="portfolio" name="portfolio">
      </div>
      <div class="form-group">
        <label for="salary">Expected Salary (optional)</label>
        <input type="number" id="salary" name="salary" min="0" step="1000">
      </div>
    </section>

    <section class="section">
      <h2>Select & Dropdown</h2>
      <div class="form-group">
        <label for="country">Country</label>
        <select id="country" name="country" required>
          <option value="">Select country...</option>
          <option value="US">United States</option>
          <option value="UK">United Kingdom</option>
          <option value="IN">India</option>
        </select>
      </div>
      <div class="form-group">
        <label for="experience">Years of Experience</label>
        <select id="experience" name="experience">
          <option value="0-1">0-1 years</option>
          <option value="1-3">1-3 years</option>
          <option value="3-5">3-5 years</option>
          <option value="5+">5+ years</option>
        </select>
      </div>
    </section>

    <section class="section">
      <h2>Date Fields</h2>
      <div class="form-group">
        <label for="start_date">Available Start Date</label>
        <input type="date" id="start_date" name="start_date">
      </div>
    </section>

    <section class="section">
      <h2>Checkbox & Radio</h2>
      <div class="form-group">
        <label><input type="checkbox" name="gdpr_consent" required> I agree to the privacy policy</label>
      </div>
      <div class="form-group">
        <label>Work authorization:</label>
        <label><input type="radio" name="work_auth" value="yes"> Authorized to work</label>
        <label><input type="radio" name="work_auth" value="no"> Require sponsorship</label>
      </div>
    </section>

    <section class="section">
      <h2>ARIA & Data Attributes</h2>
      <div class="form-group">
        <input type="text" aria-label="How did you hear about us?" name="referral_source" data-field="referral">
      </div>
      <div class="form-group">
        <input type="text" data-automation-id="input-customQuestion" placeholder="Custom question?" data-testid="custom-q">
      </div>
    </section>

    <section class="section hidden-section">
      <h2>Hidden Section (for includeHidden test)</h2>
      <input type="text" id="hidden_field" name="hidden_field" placeholder="Should appear when includeHidden=true">
    </section>

    <section class="section">
      <h2>ContentEditable (Rich Text)</h2>
      <div class="form-group">
        <label for="richtext">Paste experience (contenteditable)</label>
        <div id="richtext" contenteditable="true" role="textbox" style="border:1px solid #ccc; padding:8px; min-height:80px;"></div>
      </div>
    </section>

    <button type="submit">Submit Application</button>
  </form>

  <div id="test-result"></div>

  <script>
    // Expose expected fields for test assertions
    window.__SCraperTestExpected__ = {
      standardFields: ["first_name", "last_name", "email", "phone", "resume", "cover_letter"],
      minTotalFields: 15,
      requiredFields: ["first_name", "last_name", "email", "resume", "country", "gdpr_consent"],
    };
    // Test runner: trigger scrape and capture result
    window.runScraperTest = function() {
      return new Promise(function(resolve) {
        document.addEventListener("scraper-test-response", function onResp(e) {
          document.removeEventListener("scraper-test-response", onResp);
          window.__scraperTestResult__ = e.detail;
          resolve(e.detail);
        }, { once: true });
        document.dispatchEvent(new CustomEvent("scraper-test-request"));
      });
    };
  </script>
</body>
</html>
